!function(){"use strict";angular.module("myApp",[]).factory("gameLogic",function(){function a(){return[["BR","BN","BB","BQ","BK","BB","BN","BR"],["BP","BP","BP","BP","BP","BP","BP","BP"],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["WP","WP","WP","WP","WP","WP","WP","WP"],["WR","WN","WB","WQ","WK","WB","WN","WR"]]}function b(a,b,c,d,e,f){if(c[b])return!1;for(var g=D(b),i=0;8>i;i++)for(var j=0;8>j;j++)if(""!==a[i][j]&&a[i][j].charAt(0)===g){var k=a[i][j],l={row:i,col:j};switch(k.charAt(1)){case"K":if(h(a,b,l,c,d,e))return!1;break;case"Q":if(n(a,b,l))return!1;break;case"R":if(q(a,b,l))return!1;break;case"B":if(t(a,b,l))return!1;break;case"N":if(w(a,b,l))return!1;break;case"P":if(z(a,b,l,f))return!1}}return!0}function c(a,b,c,d,e,f){if(c[b]){var g=D(b),i=l(a,b);if(!h(a,b,i,c,d,e)){for(var j=0;8>j;j++)for(var k=0;8>k;k++)if(""!==a[j][k]&&a[j][k].charAt(0)===g){var m=a[j][k],o={row:j,col:k};switch(m.charAt(1)){case"Q":if(n(a,b,o,d,e))return"";break;case"R":if(q(a,b,o))return"";break;case"B":if(t(a,b,o))return"";break;case"N":if(w(a,b,o))return"";break;case"P":if(z(a,b,o,f))return""}}return C(b)}}return""}function d(d,h,i,k,l,n,o,q){console.log("CreateMove arguments: "+angular.toJson([d,h,i,k,l,n,o,q])),d||(d=a()),l||(l=[!1,!1]),n||(n=[!0,!0]),o||(o=[!0,!0]),q||(q={row:null,col:null});var r=d[i.row][i.col];if(""!==r&&r.charAt(0)===(0===k?"W":"B"))throw new Error("One can only make a move in an empty position or capture opponent's piece!");if(h.row===i.row&&h.col===i.col)throw new Error("Cannot move to same position.");if(""!==c(d,k,l,n,o,q)||b(d,k,l,n,o,q))throw new Error("Can only make a move if the game is not over!");var t=angular.copy(d),u=angular.copy(l),w=angular.copy(n),x=angular.copy(o),z=angular.copy(q),A=d[h.row][h.col],B=D(k);if(B!==A.charAt(0))throw new Error("Illegal to move this piece!");switch(A.charAt(1)){case"K":if(e(d,h,i,k,n))t[i.row][i.col]=A,t[h.row][h.col]="",t[i.row][i.col-1]=B+"R",t[i.row][7]="",w[k]=!1,x[k]=!1;else if(f(d,h,i,k,o))t[i.row][i.col]=A,t[h.row][h.col]="",t[i.row][i.col+1]=B+"R",t[i.row][0]="",w[k]=!1,x[k]=!1;else{if(!g(d,h,i,k))throw new Error("Illegal move for king.");t[i.row][i.col]=A,t[h.row][h.col]=""}break;case"Q":if(!m(d,h,i,k))throw new Error("Illegal move for Queen");t[i.row][i.col]=A,t[h.row][h.col]="";break;case"R":if(!p(d,h,i,k))throw new Error("Illegal move for Rook");t[i.row][i.col]=A,t[h.row][h.col]="";break;case"B":if(!s(d,h,i,k))throw new Error("Illegal move for Bishop");t[i.row][i.col]=A,t[h.row][h.col]="";break;case"N":if(!v(d,h,i,k))throw new Error("Illegal move for Knight");t[i.row][i.col]=A,t[h.row][h.col]="";break;case"P":if(!y(d,h,i,k,q))throw new Error("Illegal move for Pawn");t[i.row][i.col]=A,q.row&&h.row===q.row&&h.col!==i.col&&1===Math.abs(h.col-q.col)&&(t[q.row][q.col]="",z.row=null,z.col=null),t[h.row][h.col]="","W"===B&&4===i.row&&("BP"===t[i.row][i.col-1]||"BP"===t[i.row][i.col+1])&&(z.row=i.row,z.col=i.col),"B"===B&&3===i.row&&("WP"===t[i.row][i.col-1]||"WP"===t[i.row][i.col+1])&&(z.row=i.row,z.col=i.col),(0===i.row||7===i.row)&&(t[i.row][i.col]="W"===B?"WQ":"BQ");break;default:throw new Error("Unknown piece type!")}var C=1-k;j(t,C)&&(u[C]=!0);var E,F=c(t,C,u,w,x,z);return E=""!==F||b(t,C,u,w,x,z)?{endMatch:{endMatchScores:"W"===F?[1,0]:"B"===F?[0,1]:[0,0]}}:{setTurn:{turnIndex:C}},[E,{set:{key:"board",value:t}},{set:{key:"deltaFrom",value:{row:h.row,col:h.col}}},{set:{key:"deltaTo",value:{row:i.row,col:i.col}}},{set:{key:"isUnderCheck",value:u}},{set:{key:"canCastleKing",value:w}},{set:{key:"canCastleQueen",value:x}},{set:{key:"enpassantPosition",value:z}}]}function e(a,b,c,d,e){var f=b.row,g=b.col,h=c.col,i=0===d?7:0,j=D(d);if(k(a,d,b))return!1;if(e[d]&&f===i&&4===g&&h-g===2){for(var l=5;6>=l;l++){if(""!==a[f][l])return!1;if(k(a,d,{row:f,col:l}))return!1}return a[i][7]===j+"R"}return!1}function f(a,b,c,d,e){var f=b.row,g=b.col,h=c.col,i=0===d?7:0,j=D(d);if(k(a,d,b))return!1;if(e[d]&&f===i&&4===g&&g-h===2){for(var l=1;3>=l;l++){if(""!==a[f][l])return!1;if(k(a,d,{row:f,col:l}))return!1}return a[i][0]===j+"R"}return!1}function g(a,b,c,d){var e=b.row,f=b.col,g=c.row,h=c.col;if(0>g||0>h||g>7||h>7)return!1;var i=a[g][h],j=C(d);if(""!==i&&i.charAt(0)!==j)return!1;for(var k=e-1;e+1>=k;k++)for(var l=f-1;f+1>=l;l++)if(k>=0&&7>=k&&l>=0&&7>=l&&k===g&&l===h)return B(a,d,b,c);return!1}function h(a,b,c,d,e,f){return 0!==i(a,b,c,d,e,f).length}function i(a,b,c,d,g,h){for(var i=c.row,j=c.col,k=[],l=i-1;i+1>=l;l++)for(var m=j-1;j+1>=m;m++)if(l>=0&&7>=l&&m>=0&&7>=m&&""===a[l][m]){var n={row:l,col:m};B(a,b,c,n)&&k.push(n)}return!d[b]&&e(a,c,{row:i,col:j+2},b,g)&&k.push({row:i,col:j+2}),!d[b]&&f(a,c,{row:i,col:j-2},b,h)&&k.push({row:i,col:j-2}),k}function j(a,b){var c=l(a,b);if(c)return k(a,b,c);throw new Error("Your king is missing and the game should end!")}function k(a,b,c){for(var d=C(b),e=[],f=0;8>f;f++)for(var h=0;8>h;h++)if(""!==a[f][h]&&a[f][h].charAt(0)===d){var i=a[f][h],j={row:f,col:h};switch(i.charAt(1)){case"K":g(a,j,c,1-b)&&e.push(j);break;case"Q":m(a,j,c,1-b)&&e.push(j);break;case"R":p(a,j,c,1-b)&&e.push(j);break;case"B":s(a,j,c,1-b)&&e.push(j);break;case"N":v(a,j,c,1-b)&&e.push(j);break;case"P":y(a,j,c,1-b)&&e.push(j)}}return 0!==e.length}function l(a,b){for(var c=0===b?"WK":"BK",d=0;8>d;d++)for(var e=0;8>e;e++)if(a[d][e]===c)return{row:d,col:e}}function m(a,b,c,d){return p(a,b,c,d)||s(a,b,c,d)}function n(a,b,c){return q(a,b,c)||t(a,b,c)}function o(a,b,c){return r(a,b,c).concat(u(a,b,c))}function p(a,b,c,d){var e=b.row,f=b.col,g=c.row,h=c.col;if(0>g||0>h||g>7||h>7)return!1;var i=a[g][h],j=C(d);if(""!==i&&i.charAt(0)!==j)return!1;if(e===g){if(f===h)return!1;for(var k=h>f?f+1:h+1;(h>f?h:f)>k;k++)if(""!==a[e][k])return!1;return B(a,d,b,c)}if(f===h){if(e===g)return!1;for(var l=g>e?e+1:g+1;(g>e?g:e)>l;l++)if(""!==a[l][f])return!1;return B(a,d,b,c)}return!1}function q(a,b,c){return 0!==r(a,b,c).length}function r(a,b,c){for(var d=c.row,e=c.col,f=[],g=1;7>=g;g++){var h={row:d+g,col:e},i={row:d-g,col:e},j={row:d,col:e+g},k={row:d,col:e-g};p(a,c,h,b)&&f.push(h),p(a,c,i,b)&&f.push(i),p(a,c,j,b)&&f.push(j),p(a,c,k,b)&&f.push(k)}return f}function s(a,b,c,d){var e=b.row,f=b.col,g=c.row,h=c.col;if(0>g||0>h||g>7||h>7)return!1;var i=a[g][h],j=C(d);if(""!==i&&i.charAt(0)!==j)return!1;if(e===g&&f===h||Math.abs(e-g)!==Math.abs(f-h))return!1;for(var k=1;k<Math.abs(e-g);k++){var l="";if(l=g>e?a[e+k][h>f?f+k:f-k]:a[e-k][h>f?f+k:f-k],""!==l)return!1}return B(a,d,b,c)}function t(a,b,c){return 0!==u(a,b,c).length}function u(a,b,c){for(var d=c.row,e=c.col,f=[],g=1;7>=g;g++){var h={row:d-g,col:e-g},i={row:d-g,col:e+g},j={row:d+g,col:e-g},k={row:d+g,col:e+g};s(a,c,h,b)&&f.push(h),s(a,c,i,b)&&f.push(i),s(a,c,j,b)&&f.push(j),s(a,c,k,b)&&f.push(k)}return f}function v(a,b,c,d){var e=b.row,f=b.col,g=c.row,h=c.col;if(0>g||0>h||g>7||h>7)return!1;var i=a[g][h],j=C(d);return""!==i&&i.charAt(0)!==j?!1:2===Math.abs(e-g)&&1===Math.abs(f-h)?B(a,d,b,c):1===Math.abs(e-g)&&2===Math.abs(f-h)?B(a,d,b,c):!1}function w(a,b,c){return 0!==x(a,b,c).length}function x(a,b,c){for(var d=c.row,e=c.col,f=[],g=d-2;d+2>=g;g++)if(g!==d){var h={row:g,col:e-1},i={row:g,col:e-2},j={row:g,col:e+1},k={row:g,col:e+2};v(a,c,h,b)&&f.push(h),v(a,c,i,b)&&f.push(i),v(a,c,j,b)&&f.push(j),v(a,c,k,b)&&f.push(k)}return f}function y(a,b,c,d,e){var f=b.row,g=b.col,h=c.row,i=c.col,j=D(d);if(0>h||0>i||h>7||i>7)return!1;var k=a[h][i],l=C(d);return""!==k&&k.charAt(0)!==l?!1:2===Math.abs(f-h)&&i===g&&f===("W"===j?6:1)&&""===a[(f>h?f:h)-1][i]&&""===k?B(a,d,b,c):1===Math.abs(f-h)&&g===i&&""===k?B(a,d,b,c):1===Math.abs(f-h)&&1===Math.abs(g-i)&&(k.charAt(0)===l||""===k&&e&&e.row&&e.col)?B(a,d,b,c):!1}function z(a,b,c,d){return 0!==A(a,b,c,d).length}function A(a,b,c,d){for(var e,f=c.row,g=c.col,h=[],i=D(b),j=g-1;g+1>=j;j++){e="W"===i?f-1:f+1;var k={row:e,col:j};y(a,c,k,b,d)&&h.push(k)}e="W"===i?f-2:f+2;var l={row:e,col:g};return y(a,c,l,b,d)&&h.push(l),h}function B(a,b,c,d){var e=c.row,f=c.col,g=d.row,h=d.col,i=C(b);if(a[g][h]===i+"K")return!0;var k=angular.copy(a);return k[g][h]=k[e][f],k[e][f]="",j(k,b)?!1:!0}function C(a){return 0===a?"B":"W"}function D(a){return 0===a?"W":"B"}function E(a){var b=a.move,c=a.turnIndexBeforeMove,e=a.stateBeforeMove;try{var f=b[2].set.value,g=b[3].set.value,h=e.isUnderCheck,i=e.canCastleKing,j=e.canCastleQueen,k=e.enpassantPosition,l=e.board;console.log("isMoveOk arguments: "+angular.toJson([l,f,g,c,h,i,j,k]));var m=d(l,f,g,c,h,i,j,k);if(!angular.equals(b,m))return!1}catch(n){return!1}return!0}function F(a,b,c,d,e,f){if(!a)return[];for(var g=[],h=0===b?"W":"B",j=0;7>=j;j++)for(var k=0;7>=k;k++){var l=a[j][k];if(""!==l&&l.charAt(0)===h){var m={row:j,col:k};switch(l.charAt(1)){case"K":g.push([m,i(a,b,m,c,d,e)]);break;case"Q":g.push([m,o(a,b,m)]);break;case"R":g.push([m,r(a,b,m)]);break;case"B":g.push([m,u(a,b,m)]);break;case"N":g.push([m,x(a,b,m)]);break;case"P":g.push([m,A(a,b,m,f)])}}}for(var n=[],p=0;p<g.length;p++)g[p]&&g[p][1].length&&n.push(g[p]);return n}return{getInitialBoard:a,getPossibleMoves:F,getKingPossibleMoves:i,getQueenPossibleMoves:o,getRookPossibleMoves:r,getBishopPossibleMoves:u,getKnightPossibleMoves:x,getPawnPossibleMoves:A,createMove:d,isMoveOk:E}})}(),function(){"use strict";angular.module("myApp").controller("ChessCtrl",["$scope","$log","$timeout","gameService","stateService","gameLogic","resizeGameAreaService","$translate",function(a,b,c,d,e,f,g){function h(){var c=f.getPossibleMoves(a.board,a.turnIndex,a.isUnderCheck,a.canCastleKing,a.canCastleQueen,a.enpassantPosition);if(c.length){var e=Math.floor(Math.random()*c.length),g=c[e],h=Math.floor(Math.random()*g[1].length);a.deltaFrom=g[0],a.deltaTo=g[1][h],d.makeMove(f.createMove(a.board,a.deltaFrom,a.deltaTo,a.turnIndex,a.isUnderCheck,a.canCastleKing,a.canCastleQueen,a.enpassantPosition))}else b.info("no there are no possible moves!")}function i(b){a.board=b.stateAfterMove.board,a.deltaFrom=b.stateAfterMove.deltaFrom,a.deltaTo=b.stateAfterMove.deltaTo,a.isUnderCheck=b.stateAfterMove.isUnderCheck,a.canCastleKing=b.stateAfterMove.canCastleKing,a.canCastleQueen=b.stateAfterMove.canCastleQueen,a.enpassantPosition=b.stateAfterMove.enpassantPosition,void 0===a.board&&(a.board=f.getInitialBoard()),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(h,500)),a.rotate="playBlack"===b.playMode?!0:!1,n=[]}function j(b,c,d){var e=0===b?"B":"W";return""===a.board[c][d]||a.board[c][d].charAt(0)===e}function k(a){switch(a){case"WK":return"imgs/Chess-whiteKing.png";case"WQ":return"imgs/Chess-whiteQueen.png";case"WR":return"imgs/Chess-whiteRook.png";case"WB":return"imgs/Chess-whiteBishop.png";case"WN":return"imgs/Chess-whiteKnight.png";case"WP":return"imgs/Chess-whitePawn.png";case"BK":return"imgs/Chess-blackKing.png";case"BQ":return"imgs/Chess-blackQueen.png";case"BR":return"imgs/Chess-blackRook.png";case"BB":return"imgs/Chess-blackBishop.png";case"BN":return"imgs/Chess-blackKnight.png";case"BP":return"imgs/Chess-blackPawn.png";default:return""}}function l(a,b){var c=!1,d=!1;return c=a%2===0,d=b%2===0,c&&d||!c&&!d}function m(a,b,c){for(var d={row:a,col:b},e=0;e<c.length;e++)if(angular.equals(d,c[e][0]))return!0;return!1}g.setWidthToHeight(1);var n=[];a.convertDeltaToUIIndex=function(a,b){return 8*a+b},window.e2e_test_stateService=e,a.cellClicked=function(c,e){if(b.info(["Clicked on cell:",c,e]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(a.isYourTurn&&(a.rotate&&(c=7-c,e=7-e),1===n.length&&j(a.turnIndex,c,e)?n.push({row:c,col:e}):n[0]={row:c,col:e},2===n.length))try{a.deltaFrom=n[0],a.deltaTo=n[1];var g=f.createMove(a.board,a.deltaFrom,a.deltaTo,a.turnIndex,a.isUnderCheck,a.canCastleKing,a.canCastleQueen,a.enpassantPosition);a.isYourTurn=!1,d.makeMove(g)}catch(h){return void b.info(["Exception throwned when create move in position:",c,e])}finally{n=[]}},a.isSelected=function(b,c){a.rotate&&(b=7-b,c=7-c);var d=0===a.turnIndex?"W":"B";return n[0]&&n[0].row===b&&n[0].col===c&&a.board[b][c].charAt(0)===d},a.shouldShowImage=function(b,c){a.rotate&&(b=7-b,c=7-c);var d=a.board[b][c];return""!==d},a.getImageSrc=function(b,c){a.rotate&&(b=7-b,c=7-c);var d=a.board[b][c];return k(d)},a.getPieceKindInId=function(b,c){return a.board?(a.rotate&&(b=7-b,c=7-c),a.board[b][c]):void 0},a.getBackgroundSrc=function(a,b){return l(a,b)?"imgs/Chess-lightCell.png":"imgs/Chess-darkCell.png"},a.canSelect=function(b,c){if(!a.board)return!0;if(a.isYourTurn){a.rotate&&(b=7-b,c=7-c);var d=0===a.turnIndex?"W":"B";if(a.board[b][c].charAt(0)===d){a.isUnderCheck||(a.isUnderCheck=[!1,!1]),a.canCastleKing||(a.canCastleKing=[!0,!0]),a.canCastleQueen||(a.canCastleQueen=[!0,!0]),a.enpassantPosition||(a.enpassantPosition={row:null,col:null});var e=f.getPossibleMoves(a.board,a.turnIndex,a.isUnderCheck,a.canCastleKing,a.canCastleQueen,a.enpassantPosition);return m(b,c,e)}return!1}},a.isBlackPiece=function(b,c){return a.rotate&&(b=7-b,c=7-c),"B"===a.board[b][c].charAt(0)},a.isWhitePiece=function(b,c){return a.rotate&&(b=7-b,c=7-c),"W"===a.board[b][c].charAt(0)},d.setGame({gameDeveloperEmail:"xzzhuchen@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:i})}])}();
//# sourceMappingURL=everything.min.js.map